function CadastrarDocumento() { $("#mensagem").html("Processando seu cadastro."); try { var t = $("#txtArquivo").get(0).files, o = t[0].name.substring(t[0].name.length - 4, t[0].name.length), a = guid(); a += "." + o; var e = new FormData; e.append("file", t[0], a); var n = { CodigoDocumento: $("#txtCodigo").val(), TituloDocumento: $("#txtTitulo").val(), Revisao: $("#sltRevisao").val(), DataPlanejada: $("#txtData").val(), Valor: $("#txtValor").val(), ArquivoDocumento: a }; $.ajax({ type: "POST", url: "/Documento/CadastrarDocumento", data: n, success: function (t) { if (t instanceof Object) if (t.hasOwnProperty("IdDocumento")) $.ajax({ url: "/Documento/UploadDocumento?id=" + t.IdDocumento, type: "POST", data: e, contentType: !1, processData: !1, success: function () { $("#mensagem").html(t.Mensagem), ListarDocumentos(), LimparCampos(), $("#mensagem").html("") }, error: function (t) { $("#mensagemarquivo").html("Erro ao guardar o arquivo: " + t.status) } }); else { var o = ""; if (t.hasOwnProperty("CodigoDocumento")) { for (var a = 0; a < t.CodigoDocumento.length; a++)o += t.CodigoDocumento[a] + "\r\n"; $("#mensagemcodigo").html(o) } if (o = "", t.hasOwnProperty("TituloDocumento")) { for (a = 0; a < t.TituloDocumento.length; a++)o += t.TituloDocumento[a] + "\r\n"; $("#mensagemtitulo").html(o) } if (o = "", t.hasOwnProperty("Revisao")) { for (a = 0; a < t.Revisao.length; a++)o += t.Revisao[a] + "\r\n"; $("#mensagemrevisao").html(o) } if (o = "", t.hasOwnProperty("DataPlanejada")) { for (a = 0; a < t.DataPlanejada.length; a++)o += t.DataPlanejada[a] + "\r\n"; $("#mensagemdata").html(o) } if (o = "", t.hasOwnProperty("Valor")) { for (a = 0; a < t.Valor.length; a++)o += t.Valor[a] + "\r\n"; $("#mensagemvalor").html(o) } if (o = "", t.hasOwnProperty("ArquivoDocumento")) { for (a = 0; a < t.ArquivoDocumento.length; a++)o += t.ArquivoDocumento[a] + "\r\n"; $("#mensagemarquivo").html(ArquivoDocumento) } } else $("#mensagem").html(t) }, error: function (t) { $("#mensagem").html("Ocorreu um erro: " + t.status) } }) } catch (t) { $("#mensagem").html("Nenhum arquivo selecionado.") } } function LimparCampos() { $("#txtCodigo").val(""), $("#txtTitulo").val(""), $("#sltRevisao").val(0), $("#txtData").val(""), $("#txtValor").val("") } function ExcluirDocumento(t) { confirm("Deseja excluir este documento?") && $.ajax({ type: "GET", url: "/Documento/ExcluirDocumento/" + t, data: "", success: function (t) { $("#mensagem").html(t), ListarDocumentos(), $("#mensagem").html("") }, error: function (t) { $("#mensagem").html("Ocorreu um erro: " + t.status) } }) } function guid() { return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function (t) { var o = 16 * Math.random() | 0; return ("x" == t ? o : 3 & o | 8).toString(16) }) } function ListarDocumentos() { $.ajax({ type: "GET", url: "/Documento/ListarDocumentos", data: "", success: function (t) { var o = ""; if (t instanceof Array) for (var a = 0; a < t.length; a++)o += "<tr>", o += "<td>" + t[a].CodigoDocumento + "</td>", o += "<td>" + t[a].TituloDocumento + "</td>", o += "<td>" + TrataRevisao(t[a].Revisao) + "</td>", o += "<td>" + ConvertJSONtoDateOnlyDate(t[a].DataPlanejada) + "</td>", o += "<td>" + t[a].Valor + "</td>", o += "<td><button class='btn btn-warning btn-sm edit' data-id='" + t[a].IdDocumento + "' data-toggle='modal'>Editar</button>&nbsp;", o += "<button class='btn btn-danger btn-sm delete' data-id='" + t[a].IdDocumento + "'>Excluir</button>&nbsp;", o += "<a href='/Documentos/" + t[a].IdDocumento + "/" + t[a].ArquivoDocumento + "' class='btn btn-success btn-sm' download>Download</a>&nbsp;</td>", o += "</tr>"; $("table tbody").html(o), $("#quantidade").html(t.length), $(".edit").click(function () { ListaPorId($(this).attr("data-id")) }), $(".delete").click(function () { ExcluirDocumento($(this).attr("data-id")) }) }, error: function (t) { $("#mensagem").html("Ocorreu um erro: " + t.status) } }) } function ConvertJSONtoDateOnlyDate(t, o) { if (null === t) return ""; var a = t.substr(6), e = new Date(parseInt(a)), n = e.getMonth() + 1, i = e.getDate(), s = e.getFullYear(), l = e.getHours(), d = e.getMinutes(); e.getSeconds(); if (1 === i.toString().length && (i = "0" + i), 1 === n.toString().length && (n = "0" + n), 1 === l.toString().length && (l = "0" + l), 1 === d.toString().length && (d = "0" + d), 1 == o) var r = s + "-" + n + "-" + i; else r = i + "/" + n + "/" + s; return r } function MontaModalEdicao() { return "<div class='modal-dialog'>", "<div class='modal-content'>", "<div class='modal-header'>", "<h4 class='modal-title'><i class='fa fa-hourglass'></i>&nbsp;<span>Editar Documento</span></h4>", "</div>", "<div class='modal-body'>", "<div class='form-horizontal'>", "<input type='hidden' id='txtiddocumento'/>", "<span id='mensagemidedit' class='text-danger'></span>", "<div class='form-group'>", "<div class='col-md-10'>", "<label>Código Documento</label>", "<input type='text' class='form-control' id='txtcodigoedit'/>", "<span id='mensagemcodigoedit' class='text-danger'></span>", "</div>", "</div>", "<div class='form-group'>", "<div class='col-md-10'>", "<label>Titulo Documento</label>", "<input type='text' class='form-control' id='txttituloedit'/>", "<span id='mensagemtituloedit' class='text-danger'></span>", "</div>", "</div>", "<div class='form-group'>", "<div class='col-md-10'>", "<label>Revisão Documento</label>", "<select id='sltrevisaoedit' class='form-control'>", "<option value='0'>0</option>", "<option value='1'>A</option>", "<option value='2'>B</option>", "<option value='3'>C</option>", "<option value='4'>D</option>", "<option value='5'>E</option>", "<option value='6'>F</option>", "<option value='7'>G</option>", "</select>", "<span id='mensagemrevisaoedit' class='text-danger'></span>", "</div>", "</div>", "<div class='form-group'>", "<div class='col-md-10'>", "<label>Data Documento</label>", "<input type='date' class='form-control' id='txtdataedit'/>", "<span id='mensagemdataedit' class='text-danger'></span>", "</div>", "</div>", "<div class='form-group'>", "<div class='col-md-10'>", "<label>Valor do Documento</label>", "<input type='text' class='form-control' id='txtvaloredit'/>", "<span id='mensagemvaloredit' class='text-danger'></span>", "</div>", "</div>", "<div class='form-group'>", "<div class='col-md-10'>", "<label>Arquivo</label>", "<input type='file' id='txtarquivoedit'/>", "<span id='mensagemarquivoedit' class='text-danger'></span>", "</div>", "</div>", "</div>", "<div class='modal-footer'>", "<button class='btn btn-warning' id='btneditardados'>Editar</button>", "<input type='button' value='Cancelar' class='btn btn-info' data-dismiss='modal' onclick='window.location.reload()' />", "<span id='mensagemedit' class='text-danger'></span>", "</div>", "</div>", "</div>", "<div class='modal-dialog'><div class='modal-content'><div class='modal-header'><h4 class='modal-title'><i class='fa fa-hourglass'></i>&nbsp;<span>Editar Documento</span></h4></div><div class='modal-body'><div class='form-horizontal'><input type='hidden' id='txtiddocumento'/><span id='mensagemidedit' class='text-danger'></span><div class='form-group'><div class='col-md-10'><label>Código Documento</label><input type='text' class='form-control' id='txtcodigoedit'/><span id='mensagemcodigoedit' class='text-danger'></span></div></div><div class='form-group'><div class='col-md-10'><label>Titulo Documento</label><input type='text' class='form-control' id='txttituloedit'/><span id='mensagemtituloedit' class='text-danger'></span></div></div><div class='form-group'><div class='col-md-10'><label>Revisão Documento</label><select id='sltrevisaoedit' class='form-control'><option value='0'>0</option><option value='1'>A</option><option value='2'>B</option><option value='3'>C</option><option value='4'>D</option><option value='5'>E</option><option value='6'>F</option><option value='7'>G</option></select><span id='mensagemrevisaoedit' class='text-danger'></span></div></div><div class='form-group'><div class='col-md-10'><label>Data Documento</label><input type='date' class='form-control' id='txtdataedit'/><span id='mensagemdataedit' class='text-danger'></span></div></div><div class='form-group'><div class='col-md-10'><label>Valor do Documento</label><input type='text' class='form-control' id='txtvaloredit'/><span id='mensagemvaloredit' class='text-danger'></span></div></div><div class='form-group'><div class='col-md-10'><label>Arquivo</label><input type='file' id='txtarquivoedit'/><span id='mensagemarquivoedit' class='text-danger'></span></div></div></div><div class='modal-footer'><button class='btn btn-warning' id='btneditardados'>Editar</button><input type='button' value='Cancelar' class='btn btn-info' data-dismiss='modal' onclick='window.location.reload()' /><span id='mensagemedit' class='text-danger'></span></div></div></div>" } function ListaPorId(t) { var o; o = MontaModalEdicao(), $.ajax({ type: "GET", url: "/Documento/ListarDocumentosPorId/" + t, data: "", success: function (t) { t instanceof Object ? ($("#modal").append(""), $("#modal").append(o), $("#modal").modal({ show: !0 }), $("#txtiddocumento").val(t.IdDocumento), $("#txtcodigoedit").val(t.CodigoDocumento), $("#txttituloedit").val(t.TituloDocumento), $("#sltrevisaoedit").val(t.Revisao), $("#txtdataedit").val(ConvertJSONtoDateOnlyDate(t.DataPlanejada, 1)), $("#txtvaloredit").val(t.Valor), $("#txtvaloredit").keyup(function () { var t = $(this); t.val(t.val().replace(/[^\d,]/g, "")) }), $("#btneditardados").click(EditarDocumento)) : $("#mensagem").html("Ocorreu um erro: " + t) }, error: function (t) { $("#mensagem").html("Ocorreu um erro: " + t.status) } }) } function EditarDocumento() { $("#mensagemedit").html("Processando sua alteração."); try { var t = $("#txtarquivoedit").get(0).files, o = t[0].name.substring(t[0].name.length - 4, t[0].name.length), a = guid(); a += "." + o; var e = new FormData; e.append("file", t[0], a); var n = { IdDocumento: $("#txtiddocumento").val(), CodigoDocumento: $("#txtcodigoedit").val(), TituloDocumento: $("#txttituloedit").val(), Revisao: $("#sltrevisaoedit").val(), DataPlanejada: $("#txtdataedit").val(), Valor: $("#txtvaloredit").val(), ArquivoDocumento: a }; $.ajax({ type: "POST", url: "/Documento/EditarDocumento", data: n, success: function (t) { if (t instanceof Object) if (t.hasOwnProperty("Mensagem")) $.ajax({ url: "/Documento/UploadDocumento?id=" + t.IdDocumento, type: "POST", data: e, contentType: !1, processData: !1, success: function () { $("#mensagemedit").html(t.Mensagem), window.location.reload() }, error: function (t) { $("#mensagemedit").html("Erro ao guardar o arquivo: " + t.status) } }); else { var o = ""; if (t.hasOwnProperty("IdDocumento")) { for (var a = 0; a < t.IdDocumento.length; a++)o += t.IdDocumento[a] + "\r\n"; $("#mensagemidedit").html(o) } if (o = "", t.hasOwnProperty("CodigoDocumento")) { for (a = 0; a < t.CodigoDocumento.length; a++)o += t.CodigoDocumento[a] + "\r\n"; $("#mensagemcodigoedit").html(o) } if (o = "", t.hasOwnProperty("TituloDocumento")) { for (a = 0; a < t.TituloDocumento.length; a++)o += t.TituloDocumento[a] + "\r\n"; $("#mensagemtituloedit").html(o) } if (o = "", t.hasOwnProperty("Revisao")) { for (a = 0; a < t.Revisao.length; a++)o += t.Revisao[a] + "\r\n"; $("#mensagemrevisaoedit").html(o) } if (o = "", t.hasOwnProperty("DataPlanejada")) { for (a = 0; a < t.DataPlanejada.length; a++)o += t.DataPlanejada[a] + "\r\n"; $("#mensagemdataedit").html(o) } if (o = "", t.hasOwnProperty("Valor")) { for (a = 0; a < t.Valor.length; a++)o += t.Valor[a] + "\r\n"; $("#mensagemvaloredit").html(o) } if (o = "", t.hasOwnProperty("ArquivoDocumento")) { for (a = 0; a < t.ArquivoDocumento.length; a++)o += t.ArquivoDocumento[a] + "\r\n"; $("#mensagemarquivoedit").html(ArquivoDocumento) } } else $("#mensagemedit").html(t) }, error: function (t) { $("#mensagemedit").html("Ocorreu um erro: " + t.status) } }) } catch (t) { $("#mensagemedit").html("Nenhum arquivo selecionado.") } } function TrataRevisao(t) { switch (t) { case 0: t = 0; break; case 1: t = "A"; break; case 2: t = "B"; break; case 3: t = "C"; break; case 4: t = "D"; break; case 5: t = "E"; break; case 6: t = "F"; break; case 7: t = "G"; break; default: t = 0 }return t } $(document).ready(function () { ListarDocumentos(), $("#txtValor").keyup(function () { var t = $(this); t.val(t.val().replace(/[^\d,]/g, "")) }), $("#btncadastrar").click(CadastrarDocumento) });